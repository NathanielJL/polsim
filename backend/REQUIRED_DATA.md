# Required MongoDB Data for POLSIM

## Why Do We Keep Finding Problems?

**Root Cause**: The codebase was developed with schemas defined but initialization scripts were never run. Each feature assumes certain data exists in the database, but that data was never populated.

## Current State (Dec 5, 2024)

### ✅ Already Populated
- **Provinces**: 8 (initialized)
- **Sessions**: 2 (auto-created)
- **Demographic Slices**: 1,701 (just populated)
- **Cities**: 406 (initialized)
- **Cells**: 5,521 (map data)
- **Players**: 1 (test player created)

### ❌ Missing But Required

#### Critical (Blocks Game Startup)
1. **PopulationGroups**: 0 documents
   - Referenced by provinces and demographics
   - Needed for: Voting, reputation, population mechanics
   - Script: `run-population-distribution.js` (exists)

2. **Markets**: 0 documents
   - Needed for: Economy, company profits, policies
   - Script: `run-economic-init.js` or `run-economic-init-expanded.js`

3. **GameState**: 0 documents
   - One per session - tracks turn number, in-game date
   - Auto-created on first turn advance
   - Missing fields: turnStartTime, turnEndTime, status, inGameDate

#### Important (Blocks Features)
4. **Cultures**: 0 documents
   - Referenced by demographic slices
   - May be embedded in provinces

5. **Religions**: 0 documents
   - Referenced by demographic slices
   - May be embedded in provinces

6. **Rivers**: 0 documents
   - Map feature, not critical for gameplay
   - No initialization script exists

7. **Offices**: 0 documents
   - Government positions (Governor, Superintendent, etc.)
   - Manually created or seeded

8. **Political Parties**: 0 documents
   - Created by players in-game
   - Not required at startup

#### Optional (Created During Gameplay)
- NewsOutlets: Created by players
- NewsArticles: Generated by system
- Companies: Created by players
- Policies: Created by players
- Events: Generated by system
- Elections: Created when scheduled
- Votes: Cast by players
- Campaigns: Created by players
- Endorsements: Created by players
- Reputation Scores: Calculated dynamically

## What Needs to Happen

### Immediate (To Make Game Playable)
```bash
cd backend

# 1. Initialize population groups
node run-population-distribution.js

# 2. Initialize markets/economy
node run-economic-init-expanded.js

# 3. Verify all critical data exists
node check-mongodb-data.js
```

### After First Run
- GameState will auto-create when backend starts
- Cultures/Religions may be embedded in province data
- Rivers are cosmetic (skip for now)

## Schema vs Data Mismatch Issues

### The Pattern
1. **Schema created** with fields A, B, C
2. **Code written** assuming fields A, B, C, D, E
3. **Fields D, E never added to schema** → Validation errors
4. **Data never populated** → Runtime errors

### The Fix
1. **Immediate**: Populate critical data (populations, markets)
2. **Short-term**: Fix all schema mismatches (179 TypeScript errors)
3. **Long-term**: Add initialization checks on backend startup

## Startup Checklist

Backend should check on startup:
- [ ] At least 1 session exists
- [ ] At least 1 province exists
- [ ] Population groups exist
- [ ] Markets exist
- [ ] GameState exists for each session
- If missing → Run auto-initialization or warn user

## How Professional Games Avoid This

**NationStates** (and similar):
1. **Minimal schema** - Only essential fields
2. **Auto-initialization** - Missing data created on startup
3. **Migrations** - Schema changes handled gracefully
4. **Seeding scripts** - Database populated on first deploy
5. **Health checks** - Backend verifies data integrity before serving
6. **Simpler architecture** - PHP sessions, fewer entities

**This Game**:
- Complex schema (20+ models)
- Manual initialization required
- No startup health checks
- No auto-migration
- TypeScript strict typing exposes mismatches
